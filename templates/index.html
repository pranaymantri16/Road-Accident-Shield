<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Road Accident Prediction</title>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://bootswatch.com/4/flatly/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='index.css') }}">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  </head>
<body>

<div class="header">
  <a href="#default" class="logo">Shield</a>
  <div class="header-right">
    <a class="active" href="index.html">Home</a>
    <a href="export1.html">Map</a>
    <a href="/visual">Visualization</a>
  </div>
</div>

<div class="container">
  <div>
    <h1 class="jumbotron" style="padding: 1%">Road Accident Prediction and Classification</h1>
  </div>

  <div class="row">
    <div class="col-8">
      <div class="form-group">
        <label for="Did_Police_Officer_Attend">Did Police Officer Attend Scene of Accident</label>
        <input type="text" class="form-control" name="Did_Police_Officer_Attend" value="1" id="Did_Police_Officer_Attend">
      </div>

      <label for="Did_Police_Officer_Attend">Latitude and Longitude</label>
      <div class="row">
        <div class="col-6">
          <input type="text" class="form-control" name="lat" value="55" id="lat">
        </div>
        <div class="col-6">
          <input type="text" class="form-control" name="lon" value="-121" id="lon">
        </div>
      </div>
      <br>
      <center>
        <button id="getIt" onclick="getLocation()">üìç Get Current Location</button>
      </center>

      <div class="form-group mt-3">
        <label for="Age_of_Driver">Age of Driver</label>
        <input type="text" class="form-control" name="age_of_driver" value="34" id="age_of_driver">
      </div>

      <div class="form-group">
        <label for="Vehicle_Type">Vehicle Type</label>
        <select class="form-control" id="vehicle_type" name="vehicle_type">
          <option value="1">1 : Pedal cycle</option>
          <option value="2">2 : Motorcycle 50cc and under</option>
          <option value="3">3 : Motorcycle 125cc and unders</option>
          <option value="4">4 : Motorcycle over 125cc and up to 500cc</option>
          <option value="5">5 : Motorcycle over 500cc</option>
          <option value="8">8 : Taxi/Private hire car</option>
          <option value="9">9 : Car</option>
          <option value="10">10 : Minibus (8 - 16 passenger seats)</option>
          <option value="11">11 : Bus or coach (17 or more passenger seats)</option>
          <option value="18">18 : Tram</option>
          <option value="20">20 : Truck (Goods)</option>
          <option value="23">23 : Electric motorcycle</option>
        </select>
      </div>

      <div class="form-group">
        <label for="Age_of_Vehicle">Age of Vehicle</label>
        <input type="text" class="form-control" name="age_of_vehicle" value="10" id="age_of_vehicle">
      </div>

      <div class="form-group">
        <label for="Engine_Capacity_CC">Engine Capacity in CC</label>
        <input type="text" class="form-control" name="engine_cc" value="8300.0" id="engine_cc">
      </div>

      <div class="form-group">
        <label for="Day_of_Week">Day of Week</label>
        <select class="form-control" id="day">
          <option value="1">1 : Sunday</option>
          <option value="2">2 : Monday</option>
          <option value="3">3 : Tuesday</option>
          <option value="4">4 : Wednesday</option>
          <option value="5">5 : Thursday</option>
          <option value="6">6 : Friday</option>
          <option value="7">7 : Saturday</option>
        </select>
      </div>

      <div class="form-group">
        <label for="Weather_Conditions">Weather Conditions</label>
        <select class="form-control" id="weather" name="weather">
          <option value="1">1 : Fine no high winds</option>
          <option value="2">2 : Raining no high winds</option>
          <option value="3">3 : Snowing no high winds</option>
          <option value="4">4 : Fine + high winds</option>
          <option value="5">5 : Raining + high winds</option>
          <option value="6">6 : Snowing + high winds</option>
          <option value="7">7 : Fog or mist</option>
        </select>
      </div>

      <div class="form-group">
        <label for="Light_Conditions">Light Conditions</label>
        <select class="form-control" id="light" name="light">
          <option value="1">1 : Daylight</option>
          <option value="4">4 : Darkness - lights lit</option>
          <option value="5">5 : Darkness - lights unlit</option>
          <option value="6">6 : Darkness - no lighting</option>
        </select>
      </div>

      <div class="form-group">
        <label for="Road_Surface_Conditions">Road Surface Conditions</label>
        <select class="form-control" id="roadsc" name="roadsc">
          <option value="1">1 : Dry</option>
          <option value="2">2 : Wet or damp</option>
          <option value="3">3 : Snow</option>
          <option value="4">4 : Frost or Ice</option>
          <option value="5">5 : Flood</option>
          <option value="7">7 : Mud</option>
        </select>
      </div>

      <div class="form-group">
        <label for="Gender">Gender</label>
        <select class="form-control" id="gender" name="gender">
          <option value="1">1 : Male</option>
          <option value="2">2 : Female</option>
          <option value="3">3 : Unknown</option>
        </select>
      </div>

      <div class="form-group">
        <label for="Speed_limit">Speed Limit</label>
        <input type="text" class="form-control" name="speedl" value="30" id="speedl">
      </div>

      <button type="button" class="btn btn-success btn-block" id="submitBtn">Predict</button>
      <button type="button" class="btn btn-info btn-block" id="smsbutton">Send Email Alert</button>
    </div>

    <div class="col-4 jumbotron text-center" style="position: fixed; right: 0">
      <strong>Accident Severity Table</strong>
      <div class="alert alert-warning mt-2">
        1 = FATAL<br>2 = SERIOUS<br>3 = SLIGHT
      </div>
      <h3>OUTPUT PREDICTED:</h3>
      <div style="font-size:300%; text-align:center;" id="result"></div>
      <hr>
    </div>
  </div>
</div>

<script>
function getLocation() {
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(showPosition, showError);
  } else {
    alert("Geolocation not supported.");
  }
}

function showPosition(position) {
  const lat = position.coords.latitude.toFixed(6);
  const lon = position.coords.longitude.toFixed(6);
  $("#lat").val(lat);
  $("#lon").val(lon);
}

function showError(error) {
  alert("Error fetching location: " + error.message);
}

$(document).ready(function() {
  $("#submitBtn").click(function(e) {
    e.preventDefault();
    $("#result").html("Loading...");
    $.post(
      "/",
      {
        Did_Police_Officer_Attend: $("#Did_Police_Officer_Attend").val(),
        age_of_driver: Math.log(parseInt($("#age_of_driver").val())),
        vehicle_type: $("#vehicle_type").val(),
        age_of_vehicle: Math.log(parseInt($("#age_of_vehicle").val())),
        engine_cc: $("#engine_cc").val(),
        day: $("#day").val()[0],
        weather: $("#weather").val(),
        light: $("#light").val(),
        roadsc: $("#roadsc").val(),
        gender: $("#gender").val(),
        speedl: $("#speedl").val()
      },
      function(data) {
        $("#result").html(data);
      }
    );
  });

  $("#smsbutton").click(function(e) {
    e.preventDefault();
    $("#result").html("Sending Email...");
    $.post(
      "/sms/",
      {
        Did_Police_Officer_Attend: $("#Did_Police_Officer_Attend").val(),
        age_of_driver: Math.log(parseInt($("#age_of_driver").val())),
        vehicle_type: $("#vehicle_type").val(),
        age_of_vehicle: Math.log(parseInt($("#age_of_vehicle").val())),
        engine_cc: $("#engine_cc").val(),
        day: $("#day").val()[0],
        weather: $("#weather").val(),
        light: $("#light").val(),
        roadsc: $("#roadsc").val(),
        gender: $("#gender").val(),
        speedl: $("#speedl").val()
      },
      function(data) {
        $("#result").html(data);
      }
    );
  });
});
</script>

<footer class="footer text-center mt-4">Copyright ¬© tracker.com</footer>
</body>
</html>
